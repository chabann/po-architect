## Общая схема

Общая схема архитектуры представляет собой мультиоблачную микросервисную архитектуру с разделением на домены и использованием event-driven подхода.

![Концептуальное взаимодействие](images/concept.svg)

## Ключевые компоненты системы

### 1. Пользовательский интерфейс

* Кроссплатформенное приложение (под Android, IOS, браузерная версия)
* Веб-портал для администрирования
* Виджеты для интеграции с умными часами и фитнес-трекерами

### 2. Уже существующие части системы
- **Товары**: Каталог товаров, их описание, характеристики, связь с поатвщиками;
- **Заказы:** Список заказов пользователя. Связан с товарами и пользователями;
- **Поставщики:** Информация о поставщиках, их контакты;
- **Сервис доставки:** Информация доставке заказов пользователям.
	       

### 3. Основные домены

1. **Пользователь**
	- ***Цель:*** Обеспечить удобное, безопасное и персонализированное управление пользователями, их профилями и предпочтениями.
	- ***Функции:***
		- Регистрация и аутентификация пользователей;
		- Хранение профилей, целей, предпочтений, настроек приватности;
		- Управление правами доступа и ролями пользователей.
	- ***Сервисы домена:***
		- *Сервис Авторизации:* Аутентификация и авторизация пользователей, управление токенами доступа, реализация двухфакторной аутентификации (2FA).
		- *Профили:* Управление профилями пользователей, хранение личной информации, целей, спортивных интересов и достижений.
		- *Персональные настройки:* Настройка интерфейса приложения, управление уведомлениями и рассылками, выбор языковых и региональных параметров.

2. **Социальное взаимодействие**
	- ***Цель:*** Создание активного и вовлечённого сообщества пользователей, обеспечение общения, обмена опытом и совместных активностей.
	- ***Функции:***
		- Создание и управление группами по интересам, видам спорта, уровню подготовки;
		- Обмен сообщениями, медиаконтентом, организацию мероприятий и челленджей;
		- Модерация контента, фильтрация спама и токсичного поведения.
	- ***Сервисы домена:***
		- *Группы:* Управление группами, приглашениями, настройками приватности, рекомендациями по группам на основе интересов.
		- *Мессенджер:* Обмен текстовыми и голосовыми сообщениями, создание каналов и конференций, интеграция с эмодзи и стикерами.
		- *События:* Планирование мероприятий, управление расписанием, бронирование мест, интеграция с геосервисами и календарями.
		- *LiveJournal:* Управление пользовательским контентом (фото, видео, текстовые записи), лайки, комментарии, модерация контента.

3. **Тренировки**
	- ***Цель:*** Предоставление инструментов для планирования, отслеживания и анализа тренировок, мотивация пользователей к достижению спортивных целей.
	- ***Функции:***
		- Создание и управление тренировочными планами, рекомендации по упражнениям и нагрузке;
		- Сбор и анализ данных с датчиков и трекеров, отслеживание прогресса, визуализация результатов.
		- Сравнение с прошлыми результатами, эталонами и достижениями других пользователей.
	- ***Сервисы домена:***
		- *Планировщик тренировок:* Создание тренировочных планов, персонализированная адаптация под уровень подготовки и цели пользователя, рекомендации по упражнениям и интенсивности на основе машинного обучения, анализ больших данных и трендов;
		- *Аналитика прогресса:* Сбор и анализ данных тренировок, визуализация прогресса, расчёт ключевых показателей (пульс, темп, расстояние);
		- *Трекер тренировок:* Отслеживание тренировок в реальном времени с использованием GPS и датчиков, отображение маршрутов, скорости, пульса и других параметров. Получает данные из интеграционного домена.

4. **Экипировка**
	- ***Цель:*** Предоставление информации о спортивном инвентаре пользователя, рекомендации по обновлению и подбору экипировки, **интеграция с каталогом товаров компании**.
	- ***Функции:***
		- Управление списком экипировки пользователя, отслеживание износа и сроков службы;
		- Рекомендации по подбору экипировки на основе типа тренировок, предпочтений пользователя и местных погодных условий;
		- Интеграция с каталогом товаров компании для быстрого поиска и заказа экипировки.
	- ***Сервисы домена:***
		- *Снаряжение:* Управление личным инвентарём пользователя (обувь, одежда, снаряды), отслеживание состояния и износа;
		- *Подбор снаряжения:* Подбор экипировки на основе профиля пользователя, типа тренировок и погодных условий, рекомендации по новым моделям и брендам. Интеграция с каталогом товаров компании, отображение актуальных цен, характеристик и наличия экипировки.

5. **Маркетинг**
	- ***Цель:*** Предоставление пользователям персонализированной информации о промоакциях, скидках и специальных предложениях, увеличение продаж и лояльности к бренду.
	- ***Функции:***
		- Создание и управление маркетинговыми кампаниями, настройка таргетинга и сегментации аудитории;
		- Отображение персонализированных промоакций на основе интересов пользователя, его активности в приложении и местоположения;
	- ***Сервисы домена:***
		- *Управление кампаниями:*  Создание, управление и таргетирование маркетинговых кампаний, A/B-тестирование креативов и предложений.
		- *Промо:* Адаптация промоакций и скидок под региональные особенности, языки, валюты и культурные предпочтения пользователей.

6. **Интеграции**
	- ***Цель:*** Обеспечение взаимодействия приложения с внешними устройствами, сервисами и системами компании, расширение функциональности и улучшение пользовательского опыта.
	- ***Функции:***
		- Подключение фитнес-трекеров, датчиков пульса, весов и других устройств через Bluetooth, ANT+ и другие протоколы;
	- ***Сервисы домена:***
		- *Фитнес-часы:* Подключение и управление внешними устройствами, обработка данных, поступающих с датчиков, конвертация форматов и протоколов;
		- *Трекеры здоровью:* Передача данных в приложения для отслеживания активности и т.д.

7. **Финансы**
	- ***Цель:*** Обеспечение безопасной и удобной обработки финансовых транзакций, управление подписками, программами лояльности и вознаграждениями.
	- ***Функции:***
		- Обработка платежей и подписок, управление счетами пользователей, поддержка различных способов оплаты;
		- Начисление и списание баллов лояльности, обмен баллов на скидки, призы и другие вознаграждения;
		- Интеграция с платёжными шлюзами, банками и финансовыми сервисами.
	- ***Сервисы домена:***
		- *Платежи:* Обработка платежей и транзакций, защита от мошенничества, поддержка различных валют и платёжных систем.
		- *Подписки:* Управление подписками на премиум-функции и контент, автоматическое продление и отмена подписок, формирование счетов и уведомлений.
		- *Программы лояльности:* Управление программой лояльности, начисление и списание баллов, настройка правил и вознаграждений, интеграция с бонусными системами компании.

8. **Администрирование**
	- ***Цель:*** Предоставление инструментов для управления ролями, пользователями, контентом, системой и инфраструктурой приложения.
	- ***Функции:***
		- Управление учётными записями пользователей, ролями и правами доступа;
		- Модерация контента, фильтрация ненормативной лексики, блокировка нарушителей;
		- Мониторинг состояния системы, анализ логов, выявление и устранение проблем.
		- Для целей данного домена в частности может быть использован ELK-стек (Elastic Search, logstash, Kibana)
	- ***Сервисы домена:***
		- *Управление доступом:* Управление ролями и правами доступа, назначение ролей пользователям, ограничение доступа к функциональности приложения.
		- *Логирование:* Логирование действий пользователей и администраторов, формирование отчётов о безопасности и использовании приложения.
		- *Система мониторинга:* Мониторинг состояния серверов, баз данных и других компонентов системы, отправка уведомлений о проблемах и инцидентах.

### 4. Технические компоненты

- **Сервис уведомлений**: Управление уведомлениями, отправка push-уведомлений, email-сообщений и SMS, управление шаблонами уведомлений.

- **Брокер сообщений**: Асинхронная коммуникация между сервисами, обмен сообщениями и событиями, обеспечение отказоустойчивости и масштабируемости системы.

- **API Gateway**: Сервисы API для маршрутизации, проксирования и балансирования запросов. Также каждый домен имеет персональный API-маршрутизатор для большей независимости от реализаций конкретных микросервисов.

- **Кластер БД**: Хранение данных, могут быть использованы разные типы БД для разных сервисов, например, PostgreSQL, MongoDB, Redis.

- **Аналитические данные**: ClickHouse для аналитики получаемых данных, Hadoop для сырых данных с трекеров.
